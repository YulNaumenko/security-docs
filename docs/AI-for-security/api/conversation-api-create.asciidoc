[[conversation-api-create]]
=== Create conversation

Create a new Elastic AI Assistant conversation.

[discrete]
=== Request URL

`POST <kibana host>:<port>/api/security_ai_assistant/current_user/conversations`

[discrete]
=== Request body

[width="100%",options="header"]
|==============================================
|Name |Type |Description |Required

|`title` |String |Conversation title. By default is "New chat". Will be AI generated if not changed. |Yes
|`category` |String |Could be 'assistant' or 'insights' or not defined. |Yes
|`isDefault` |Boolean |Define if conversation is a system conversation. |Yes
|`excludeFromLastConversationStorage` |Boolean |Defines if conversation should be displayed as the latest used conversation if it was used. |Yes
|`apiConfig` |<<create-apiconfig-obj,apiConfig object>> |Conversation configuration. |Yes
|`messages` |<<create-message-obj,messages object>> |Array of conversation messages. |Yes
|`replacements` |<<create-replacements-obj,replacements object>> |List of the fields with anonymization. |Yes
|==============================================

[discrete]
[[create-apiconfig-obj]]
== `apiConfig` object

[width="100%",options="header"]
|==============================================
|Name |Type |Description |Required

|`connectorId` |String |Kibana connector ID. |Yes
|`actionTypeId` |String |Kibana connector action type ID. |Yes
|`defaultSystemPromptId` |String |Default system prompt ID. |Yes
|`model` |String |LLM specific model. |Yes
|==============================================

[discrete]
[[create-message-obj]]
== `messages` object

[width="100%",options="header"]
|==============================================
|Name |Type |Description |Required

|`role` |String |Message role. Could be "user", "assisatnt" or "system". |Yes
|`content` |String |Message content to send to LLM. |Yes
|`isError` |String |Define if the message is an error message and not LLM response. |Yes
|`timestamp` |String |Timestamp when the message was sent. |Yes
|`traceData` |Object |Tracing information. |Yes
|==============================================

[discrete]
[[create-replacements-obj]]
== Replacements object

[width="100%",options="header"]
|==============================================
|Name |Type |Description |Required

|`role` |String |Message role. Could be "user", "assisatnt" or "system". |Yes
|`content` |String |Message content to send to LLM. |Yes
|`isError` |String |Define if the message is an error message and not LLM response. |Yes
|`timestamp` |String |Timestamp when the message was sent. |Yes
|`traceData` |Object |Tracing information. |Yes
|==============================================

[discrete]
=== Example requests

*Example 1*

Creates a new conversation.

[source,console]
--------------------------------------------------
POST api/security_ai_assistant/current_user/conversations
{
  "title": "The conversation title.",
  "category": "assistant",
  "messages": [
    {
      "content": "test content",
      "role": "user",
      "isError": false,
      "timestamp": "2019-12-13T16:40:33.400Z",
      "traceData": {
        "traceId": "1234",
        "transactionId": "2"
      }
    }
  ],
  "apiConfig": {
    "actionTypeId": ".gen-ai",
    "connectorId": "86ab-471c-a00b-25b7e20c2d12",
    "defaultSystemPromptId": "Default",
    "model": "gpt-4o"
  },
  "isDefault": false,
  "excludeFromLastConversationStorage": true,
  "replacements": {
    "field1": "914beb92-86ab-471c-a00b"
  }
}
--------------------------------------------------

[discrete]
=== Response code

`200`
    Indicates a successful call.

[discrete]
=== Response payload

A JSON conversation object with a unique `id`.

*Example 1*

Conversation response payload:

[source,json]
--------------------------------------------------
{
  "id": "07805df2-6462-451a-b534-78da47873c42",
  "title": "The conversation title.",
  "category": "assistant",
  "timestamp": "2024-07-29T06:58:15.670Z",
  "updatedAt": "2024-07-29T06:58:15.670Z",
  "createdAt": "2024-07-29T06:58:15.670Z",
  "replacements": {
    "field1": "914beb92-86ab-471c-a00b"
  },
  "users": [
    {
      "name": "elastic"
    }
  ],
  "messages": [
    {
      "content": "test content",
      "role": "user",
      "timestamp": "2019-12-13T16:40:33.400Z",
      "traceData": {
        "transactionId": "2",
        "traceId": "1234"
      }
    }
  ],
  "apiConfig": {
    "connectorId": "86ab-471c-a00b-25b7e20c2d12",
    "actionTypeId": ".gen-ai",
    "defaultSystemPromptId": "Default",
    "model": "gpt-4o"
  },
  "isDefault": false,
  "excludeFromLastConversationStorage": true,
  "namespace": "default"
}
--------------------------------------------------

